  ##Role for installing Argocd 
---
  - name: creating the namespace 
    command: kubectl create namespace argocd 

  - name: Applying the repo 
    command: kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

  - name: exposing the server 
    command: kubectl expose svc argocd-server -n argocd --type=NodePort --port=8080 --name=argocd-new-server

  - name: Accessing the argocd-new-server
    command: kubectl get svc argocd-new-server -n argocd > /tmp/argocd-server

  - name: filtering the output to port
    command: cat /tmp/argocd-serve | awk '{split($5, a, ":"); split(a[2], b, "/"); print b[1]}'
    register: port_value

  - name:  getting the hostname 
    command: hostname -I | awk '{print $1}'
    register: host_ip

  - name: printing the url for acccessing the argocd UI
    debug: 
      msg: "{{host_ip}}:{{port_value}}"


